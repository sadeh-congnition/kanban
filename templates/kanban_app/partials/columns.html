{% for column in columns %}
<div class="column" data-column-id="{{ column.id }}">
    <div class="column-header">
        <h3>{{ column.name }}</h3>
        <div class="column-actions">
            <!-- Add Task Button -->
            <button class="btn btn-sm btn-ghost" hx-get="/api/columns/{{ column.id }}/tasks/form"
                hx-target="#modal-container" hx-swap="innerHTML" title="Add Task">
                + Add
            </button>
            <!-- Delete Column Button -->
            <button class="btn btn-sm btn-danger" hx-delete="/api/columns/{{ column.id }}"
                hx-confirm="Are you sure you want to delete this column and all its tasks?" title="Delete Column">
                &times;
            </button>
        </div>
    </div>

    <div class="column-body">
        {% for task in column.tasks.all %}
        <div class="task-card" data-task-id="{{ task.id }}" style="cursor: pointer;"
            hx-get="/api/tasks/{{ task.id }}/details" hx-target="#modal-container" hx-swap="innerHTML">
            <div style="font-size: 0.75rem; color: #a1a1aa; margin-bottom: 0.25rem;">
                #{{task.project_task_id|default:task.id }}</div>
            <div class="task-title">{{ task.title }}</div>
            {% if task.tags.all %}
            <div class="task-tags"
                style="display: flex; flex-wrap: wrap; gap: 0.25rem; margin-top: 0.3rem; margin-bottom: 0.3rem;">
                {% for tag in task.tags.all %}
                <span
                    style="background-color: {{ tag.color }}; color: white; padding: 0.1rem 0.4rem; border-radius: 999px; font-size: 0.7rem; font-weight: 500;">
                    {{ tag.name }}
                </span>
                {% endfor %}
            </div>
            {% endif %}
            {% if task.description %}
            <div class="task-desc">{{ task.description }}</div>
            {% endif %}
            <div class="task-assignee" style="margin-bottom: 0.3rem; display: flex; gap: 0.25rem; align-items: center;">
                <button class="btn btn-sm btn-ghost"
                    style="padding: 0.1rem 0.3rem; font-size: 0.75rem; color: #52525b; display: flex; align-items: center; gap: 0.2rem;"
                    hx-get="/api/tasks/{{ task.id }}/assign/form" hx-target="#modal-container" hx-swap="innerHTML"
                    title="Assign User" onclick="event.stopPropagation()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    {% if task.assigned_to %}
                    {{ task.assigned_to.username }}
                    {% else %}
                    Unassigned
                    {% endif %}
                </button>
                {% if task.assigned_to_id != request.user.id %}
                <button class="btn btn-sm btn-ghost" style="padding: 0.1rem 0.3rem; font-size: 0.75rem;"
                    hx-post="/api/tasks/{{ task.id }}/assign" hx-vals='{"user_id": "{{ request.user.id }}"}'
                    hx-swap="none" title="Assign to me" onclick="event.stopPropagation()">
                    Assign to me
                </button>
                {% endif %}
            </div>
            <div class="task-actions" style="display: flex; gap: 0.25rem;">
                <button class="btn btn-sm btn-ghost" style="padding: 0.1rem 0.3rem;"
                    hx-get="/api/tasks/{{ task.id }}/tags/form" hx-target="#modal-container" hx-swap="innerHTML"
                    title="Edit Tags" onclick="event.stopPropagation()">
                    Tags
                </button>
                <button class="btn btn-sm btn-danger" style="padding: 0.1rem 0.3rem;"
                    hx-delete="/api/tasks/{{ task.id }}" hx-confirm="Delete this task?" title="Delete Task"
                    onclick="event.stopPropagation()">
                    &times;
                </button>
            </div>
        </div>
        {% empty %}
        <!-- Empty placeholder to ensure SortableJS works with empty lists -->
        <div style="height: 10px; width: 100%;"></div>
        {% endfor %}
    </div>

    <div class="column-footer">
        <button class="btn btn-sm btn-ghost" style="width: 100%" hx-get="/api/columns/{{ column.id }}/tasks/form"
            hx-target="#modal-container" hx-swap="innerHTML">
            + Add a card
        </button>
    </div>
</div>
{% endfor %}