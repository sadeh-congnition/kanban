<div class="modal-overlay" onclick="if(event.target === this) closeModal()">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2 class="modal-title">{{ task.title }}</h2>
            <button class="btn btn-ghost" onclick="closeModal()">&times;</button>
        </div>

        <div style="margin-bottom: 1.5rem;">
            <p style="color: #52525b; font-size: 0.9rem; margin-top: 0;">#{{ task.project_task_id|default:task.id }} in
                <strong>{{ task.column.name }}</strong>
            </p>
        </div>

        <div style="display: flex; gap: 2rem; flex-wrap: wrap;">

            <div style="flex: 2; min-width: 300px;">
                <h3 style="font-size: 1rem; margin-bottom: 0.5rem; color: #3f3f46;">Description</h3>
                {% if task.description %}
                <div
                    style="background-color: #f4f4f5; padding: 1rem; border-radius: 0.5rem; color: #3f3f46; font-size: 0.95rem; white-space: pre-wrap;">
                    {{ task.description }}</div>
                {% else %}
                <p style="color: #a1a1aa; font-style: italic; font-size: 0.9rem;">No description provided.</p>
                {% endif %}
            </div>

            <div style="flex: 1; min-width: 200px; display: flex; flex-direction: column; gap: 1.5rem;">

                <div>
                    <h3 style="font-size: 1rem; margin-bottom: 0.5rem; color: #3f3f46;">Assignee</h3>
                    <form hx-post="/api/tasks/{{ task.id }}/assign" hx-swap="none">
                        <select name="user_id" class="form-control" style="margin-bottom: 0.5rem;"
                            onchange="this.form.querySelector('button').style.display = 'block';">
                            <option value="" {% if not task.assigned_to_id %}selected{% endif %}>Unassigned</option>
                            {% for u in users %}
                            {% if task.assigned_to_id == u.id %}
                            <option value="{{ u.id }}" selected>{{ u.username }}</option>
                            {% else %}
                            <option value="{{ u.id }}">{{ u.username }}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-sm btn-primary" style="display: none; width: 100%;">Save
                            Assignment</button>
                    </form>
                </div>

                <div>
                    <h3 style="font-size: 1rem; margin-bottom: 0.5rem; color: #3f3f46;">Tags</h3>
                    <form hx-post="/api/tasks/{{ task.id }}/tags" hx-swap="none">
                        {% if tags %}
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.5rem;">
                            {% for tag in tags %}
                            <label
                                style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.9rem; cursor: pointer; padding: 0.25rem 0.5rem; border: 1px solid #e4e4e7; border-radius: 0.375rem; user-select: none;">
                                <input type="checkbox" name="tags" value="{{ tag.id }}"
                                    onchange="this.form.querySelector('button').style.display = 'block';">
                                <span
                                    style="background-color: {{ tag.color }}; color: white; padding: 0.1rem 0.5rem; border-radius: 999px; font-size: 0.75rem;">
                                    {{ tag.name }}
                                </span>
                            </label>
                            {% endfor %}
                        </div>
                        <button type="submit" class="btn btn-sm btn-primary" style="display: none; width: 100%;">Save
                            Tags</button>
                        {% else %}
                        <p style="color: #71717a; font-size: 0.875rem;">No tags available.</p>
                        {% endif %}
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>